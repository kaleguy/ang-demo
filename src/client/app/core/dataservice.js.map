{"version":3,"sources":["dataservice.es6"],"names":[],"mappings":";;;;;;AAIA,CAAC,YAAY;;AAET,YACK,MADL,CACY,UADZ,EAEK,OAFL,CAEa,aAFb,EAE4B,WAF5B;;AAIA,gBAAY,OAAZ,GAAsB,CAAC,OAAD,EAAU,IAAV,EAAgB,WAAhB,EAA6B,QAA7B,CAAtB;;;AAGA,aAAS,WAAT,CAAqB,KAArB,EAA4B,EAA5B,EAAgC,SAAhC,EAA2C,MAA3C,EAAmD;;AAE/C,YAAI,UAAU;AACV,uBAAW,SADD;AAEV,uBAAW,SAFD;AAGV,6BAAiB;AAHP,SAAd;;AAMA,eAAO,OAAP;;AAEA,iBAAS,eAAT,GAA2B;AAAE,mBAAO,GAAG,IAAH,CAAQ,EAAR,CAAP;AAAqB;;AAElD,iBAAS,SAAT,GAAqB;AACjB,mBAAO,MAAM,GAAN,CAAU,aAAV,EACF,IADE,CACG,OADH,EAEF,KAFE,CAEI,IAFJ,CAAP;;AAIA,qBAAS,OAAT,CAAiB,QAAjB,EAA2B;AACvB,uBAAO,SAAS,IAAhB;AACH;;AAED,qBAAS,IAAT,CAAc,CAAd,EAAiB;AACb,uBAAO,UAAU,OAAV,CAAkB,0BAAlB,EAA8C,CAA9C,CAAP;AACH;AACJ;AACD,iBAAS,SAAT,GAAqB;AACjB,mBAAO,MAAM,GAAN,CAAU,aAAV,EACF,IADE,CACG,OADH,EAEF,KAFE,CAEI,IAFJ,CAAP;;AAIA,qBAAS,OAAT,CAAiB,QAAjB,EAA2B;AACvB,uBAAO,gBAAgB,SAAS,IAAzB,CAAP;AACH;;AAED,qBAAS,IAAT,CAAc,CAAd,EAAiB;AACb,uBAAO,UAAU,OAAV,CAAkB,0BAAlB,EAA8C,CAA9C,CAAP;AACH;AACJ;AACD,iBAAS,eAAT,CAAyB,IAAzB,EAA+B;;AAE3B,gBAAI,SAAS,KAAK,MAAlB;AACA,cAAE,IAAF,CAAO,MAAP,EAAe,UAAU,CAAV,EAAa;;AAExB,oBAAI,UAAU,EAAE,IAAF,CAAO,KAAK,QAAZ,EAAsB,UAAU,CAAV,EAAa;AAC7C,2BAAO,EAAE,EAAF,KAAS,EAAE,QAAlB;AACH,iBAFa,CAAd;AAGA,oBAAI,CAAC,OAAL,EAAc;AACV,4BAAQ,GAAR,CAAY,0BAAZ,EAAwC,CAAxC;AACA;AACH;;AAED,oBAAI,mBAAmB,EAAE,WAAzB;;AAEA,kBAAE,aAAF,GAAkB,EAAlB;AACA,mCAAmB,WAAW,gBAAX,CAAnB;AACA,oBAAI,iBAAiB,MAAjB,GAA0B,GAA9B,EAAmC;AAC/B,sBAAE,aAAF,GAAkB,UAAlB;AACH;AACD,kBAAE,QAAF,CAAW,CAAX,EAAa;AACT,2BAAM,EADG;AAET,8BAAU,IAFD;AAGT,iCAAa,EAHJ;AAIT,sCAAkB,gBAJT;AAKT,8BAAU,KALD;AAMT,qCAAiB,KANR;AAOT,8BAAU,EAPD;AAQT,kCAAa,EARJ;AAST,2BAAM;AATG,iBAAb;;AAYA,kBAAE,eAAF,GAAoB,QAAQ,eAA5B;AACA,kBAAE,SAAF,GAAc,EAAd;AAEH,aAhCD;AAiCA,mBAAO,IAAP;AACH;AAEJ;AAEJ,CAxFD","file":"dataservice.js","sourcesContent":["/*global lodash */\n/*global _ */\n/*global removeTags */\n\n(function () {\n\n    angular\n        .module('app.core')\n        .factory('dataservice', dataservice);\n\n    dataservice.$inject = ['$http', '$q', 'exception', 'logger'];\n\n    /* @ngInject */\n    function dataservice($http, $q, exception, logger) {\n\n        var service = {\n            getPeople: getPeople,\n            getEvents: getEvents,\n            getMessageCount: getMessageCount\n        };\n\n        return service;\n\n        function getMessageCount() { return $q.when(72); }\n\n        function getPeople() {\n            return $http.get('/api/people')\n                .then(success)\n                .catch(fail);\n\n            function success(response) {\n                return response.data;\n            }\n\n            function fail(e) {\n                return exception.catcher('XHR Failed for getPeople')(e);\n            }\n        }\n        function getEvents() {\n            return $http.get('/api/events')\n                .then(success)\n                .catch(fail);\n\n            function success(response) {\n                return normalizeEvents(response.data);\n            }\n\n            function fail(e) {\n                return exception.catcher('XHR Failed for getPeople')(e);\n            }\n        }\n        function normalizeEvents(data) {\n\n            var events = data.events;\n            _.each(events, function (e) {\n\n                var account = _.find(data.accounts, function (a) {\n                    return a.id === e.calendar;\n                });\n                if (!account) {\n                    console.log('No matching account for:', e);\n                    return;\n                }\n\n                var shortDescription = e.description;\n                // need this if text is too long\n                e.ellipsisClass = '';\n                shortDescription = removeTags(shortDescription);\n                if (shortDescription.length > 200) {\n                    e.ellipsisClass = 'ellipsis';\n                }\n                _.defaults(e,{\n                    title:'',\n                    readOnly: true,\n                    description: '',\n                    shortDescription: shortDescription,\n                    canceled: false,\n                    rsvpStatusDescr: false,\n                    location: '',\n                    participants:[],\n                    owner:''\n                });\n\n                e.backgroundColor = account.backgroundColor;\n                e.className = [];\n\n            });\n            return data;\n        }\n\n    }\n\n})();\n"]}