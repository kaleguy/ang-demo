{"version":3,"sources":["calendar.controller.js"],"names":[],"mappings":"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","file":"calendar.controller-compiled.js","sourcesContent":["(function () {\n    'use strict';\n\n    angular\n        .module('app.calendar')\n        .controller('CalendarController', CalendarController);\n\n\n    CalendarController.$inject =\n        ['$scope', '$timeout', '$compile', '$document', 'logger', 'uiCalendarConfig', 'dataservice'];\n    /* @ngInject */\n    function CalendarController($scope, $timeout, $compile, $document, logger, uiCalendarConfig, dataservice) {\n\n        var vm = this;\n        vm.title = 'Calendar';\n        var editable = true;\n        var events = [];\n\n        // display of filter lists\n        vm.isCollapsedCal = true;\n        vm.isCollapsedOwn = true;\n\n\n        //  next two functions are for hiding popover.\n        //  (trigger:focus doesn't work with container: body)\n        $document.bind('keypress', function (e) {\n            if (e.keyCode === 27) {\n                $('.popover').popover('hide');\n                $scope.$apply();\n            }\n        });\n        $('body').on('click', function (e) {\n            let a = $(e.target).parents('A');\n            let pop_id = a.attr(\"aria-describedby\");\n            if (pop_id) {\n                $timeout(function () {\n                    let pop = $(\".popover[id!=\" + pop_id + \"]\");\n                    if (pop) {\n                        pop.popover('hide');\n                    }\n                }, 1);\n            } else {\n                $('.popover').popover('hide');\n            }\n        });\n\n        // load the events into the calendar\n        dataservice.getEvents().then(function(data){\n            vm = _.extend(vm, data);\n            events.push(data.events);\n        });\n\n\n\n        /**\n         * ========== FullCalendar Setup ==============\n         */\n        let buttonIcons = {\n            refresh: 'left-single-arrow'\n        };\n        $scope.uiConfig = {\n\n            calendar: {\n                height: 'auto',\n                editable: editable,\n                droppable: true,\n                timezone: \"local\",\n                buttonIcons: buttonIcons,\n                header: {\n                    left: 'prev,next today',\n                    center: 'title',\n                    right: 'month,agendaWeek,agendaDay'\n                },\n                dayClick,\n                eventClick,\n                viewRender\n            }\n        };\n        $scope.eventSources = events;\n\n        /**\n         * eventClick: show bootstrap popover with event info\n         * @param calEvent\n         * @param jsEvent\n         */\n        function eventClick (calEvent, jsEvent) {\n\n           // let eventClicked = true;\n            let el = $(jsEvent.currentTarget);\n            let item = calEvent;\n\n            // use an underscore template for the first pass on the content\n            // because apparently not possible to get the height right when\n            // using ng $compile\n            let template = _.template($('#cal_pop').html());\n\n            function _showPopover(el) {\n\n                el.popover('show');\n                el.attr('pop', true);\n                let popid = '#' + el.attr(\"aria-describedby\");\n                el.attr('tabindex', 0);\n                el.attr('role', 'button');\n\n                // Once content is drawn, we can $compile it to get the ng commands to work\n                let contentEl = $(popid + ' .popover-content');\n                let contentElChild = $(popid + ' .tool-content');\n                let ng_template = contentElChild.html();\n                let ng_el = angular.element(ng_template);\n                let compiled = $compile(ng_el);\n                contentElChild.remove();\n                contentEl.append(ng_el);\n                compiled($scope);\n\n            }\n\n            el.popover({\n                title : item.title,\n                placement: 'right',\n                container: 'body',\n                html: true,\n                trigger: 'focus',\n                content: () => template(item)\n            });\n\n            _showPopover(el);\n\n        }\n\n        /* Navigate to the Agenda view of a particular day on clicking the day cell of the Month view */\n        function dayClick (date) { // view, calendar\n            let c = uiCalendarConfig.calendars.mainCalendar;\n            c.fullCalendar('changeView', 'agendaDay');\n            c.fullCalendar('gotoDate', date);\n            $('.popover').popover('hide');\n        }\n\n        function viewRender(){}\n\n\n        /**\n         * ============ Color Picker and Filters =====================\n         */\n        vm.calendarFilters = {};\n        vm.ownerFilters = {};\n\n        const unfilterAll = function () {\n            setAll(vm.calendarFilters, false);\n            setAll(vm.ownerFilters, false);\n            //_.each(events, (e) => e.className = _.without(e.className, 'hide');\n        };\n\n        /**\n         * filterCalendars - filter calendars by account. This function also handles\n         * the click on the color square, and passes that click to the color picker.\n         * @param key\n         */\n        vm.filterCalendars = function (key) {\n            vm.calendarFilters[key] = !vm.calendarFilters[key];\n            //console.log(key, vm.calendarFilters[key]);\n            toggleHide('calendar', key, vm.calendarFilters[key])\n        };\n        vm.filterOwners = function (key) {\n            vm.ownerFilters[key] = !vm.ownerFilters[key];\n            toggleHide('owner', key, vm.ownerFilters[key]);\n        };\n\n        vm.setEventsColor = function (color, account) {\n\n            let cp_events = angular.copy(vm.events);\n            let id = account.id;\n            cp_events.forEach(function (e) {\n                if (e.calendar === id) {\n                    e.backgroundColor = color;\n                }\n            });\n            events.length = 0;\n            events.push(cp_events);\n            $scope.$apply(); // required bc angular fullcalendar does not respond to change in event backgroundColor\n\n        };\n\n        /**\n         * toggleHide: hide/show events by type (target)\n         * @param target: 'calendar' or 'owner'\n         * @param key: id of target\n         * @param hide {boolean}\n         */\n        const toggleHide = function (target, key, hide) {\n            let cp_events = angular.copy(vm.events);\n            cp_events.forEach(function (e) {\n                if (e[target] === key) {\n                    if (hide) {\n                        e.className.push('hide');\n                    } else {\n                        e.className = _.without(e.className, 'hide');\n                    }\n                }\n            });\n            events.length = 0;\n            events.push(cp_events);\n\n        };\n\n\n\n\n        activate();\n        function activate() {\n            logger.info('Activated Calendar View');\n        }\n    }\n})();\n"]}