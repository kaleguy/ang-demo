{"version":3,"sources":["calendar.controller.es6"],"names":[],"mappings":"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","file":"calendar.controller.js","sourcesContent":["/*global $ */\n/*global _ */\n/*global setAll */\n\n(function () {\n\n    angular.module('app.calendar').controller('CalendarController', CalendarController);\n\n    CalendarController.$inject = [\n        '$scope', '$timeout', '$compile', '$document',\n        'logger', 'uiCalendarConfig', 'dataservice'];\n\n    /* @ngInject */\n    function CalendarController(\n        $scope, $timeout, $compile, $document, logger,\n        uiCalendarConfig, dataservice) {\n\n        var vm = this;\n        vm.title = 'Calendar';\n        var editable = true;\n        var events = [];\n\n        // display of filter lists\n        vm.isCollapsedCal = true;\n        vm.isCollapsedOwn = true;\n\n        //  next two functions are for hiding popover.\n        //  (trigger:focus doesn't work with container: body)\n        $document.bind('keypress', function (e) {\n            if (e.keyCode === 27) {\n                $('.popover').popover('hide');\n                $scope.$apply();\n            }\n        });\n        $('body').on('click', function (e) {\n            var a = $(e.target).parents('A');\n            var popId = a.attr('aria-describedby');\n            if (popId) {\n                $timeout(function () {\n                    var pop = $('.popover[id!=' + popId + ']');\n                    if (pop) {\n                        pop.popover('hide');\n                    }\n                }, 1);\n            } else {\n                $('.popover').popover('hide');\n            }\n        });\n\n        // load the events into the calendar\n        dataservice.getEvents().then(function (data) {\n            vm = _.extend(vm, data);\n            events.push(data.events);\n        });\n\n        /**\n         * ========== FullCalendar Setup ==============\n         */\n        var buttonIcons = {\n            refresh: 'left-single-arrow'\n        };\n        $scope.uiConfig = {\n\n            calendar: {\n                height: 'auto',\n                editable: editable,\n                droppable: true,\n                timezone: 'local',\n                buttonIcons: buttonIcons,\n                header: {\n                    left: 'prev,next today',\n                    center: 'title',\n                    right: 'month,agendaWeek,agendaDay'\n                },\n                dayClick: dayClick,\n                eventClick: eventClick,\n                viewRender: viewRender\n            }\n        };\n        $scope.eventSources = events;\n\n        /**\n         * eventClick: show bootstrap popover with event info\n         * @param {object} calEvent\n         * @param {object} jsEvent\n         */\n        function eventClick(calEvent, jsEvent) {\n\n            // let eventClicked = true;\n            var el = $(jsEvent.currentTarget);\n            var item = calEvent;\n\n            // use an underscore template for the first pass on the content\n            // because apparently not possible to get the height right when\n            // using ng $compile\n            var template = _.template($('#cal_pop').html());\n\n            function _showPopover(el) {\n\n                el.popover('show');\n                el.attr('pop', true);\n                var popid = '#' + el.attr('aria-describedby');\n                el.attr('tabindex', 0);\n                el.attr('role', 'button');\n\n                // Once content is drawn, we can $compile it to get the ng commands to work\n                var contentEl = $(popid + ' .popover-content');\n                var contentElChild = $(popid + ' .tool-content');\n                var ngTemplate = contentElChild.html();\n                var ngEl = angular.element(ngTemplate);\n                var compiled = $compile(ngEl);\n                contentElChild.remove();\n                contentEl.append(ngEl);\n                compiled($scope);\n            }\n\n            el.popover({\n                title: item.title,\n                placement: 'right',\n                container: 'body',\n                html: true,\n                trigger: 'focus',\n                content: function content() {\n                    return template(item);\n                }\n            });\n\n            _showPopover(el);\n        }\n\n        /* Navigate to the Agenda view of a particular day on clicking the day cell of the Month view */\n        function dayClick(date) {\n            // view, calendar\n            var c = uiCalendarConfig.calendars.mainCalendar;\n            c.fullCalendar('changeView', 'agendaDay');\n            c.fullCalendar('gotoDate', date);\n            $('.popover').popover('hide');\n        }\n\n        function viewRender() {}\n\n        /**\n         * ============ Color Picker and Filters =====================\n         */\n        vm.calendarFilters = {};\n        vm.ownerFilters = {};\n\n        var unfilterAll = function unfilterAll() {\n            setAll(vm.calendarFilters, false);\n            setAll(vm.ownerFilters, false);\n            //_.each(events, (e) => e.className = _.without(e.className, 'hide');\n        };\n\n        /**\n         * toggleHide: hide/show events by type (target)\n         * @param {string} target - 'calendar' or 'owner'\n         * @param {string} key - id of target\n         * @param {boolean} hide\n         */\n        var toggleHide = function toggleHide(target, key, hide) {\n            var cpEvents = angular.copy(vm.events);\n            cpEvents.forEach(function (e) {\n                if (e[target] === key) {\n                    if (hide) {\n                        e.className.push('hide');\n                    } else {\n                        e.className = _.without(e.className, 'hide');\n                    }\n                }\n            });\n            events.length = 0;\n            events.push(cpEvents);\n        };\n\n        /**\n         * filterCalendars - filter calendars by account. This function also handles\n         * the click on the color square, and passes that click to the color picker.\n         * @param {string} key\n         */\n        vm.filterCalendars = function (key) {\n            vm.calendarFilters[key] = !vm.calendarFilters[key];\n            //console.log(key, vm.calendarFilters[key]);\n            toggleHide('calendar', key, vm.calendarFilters[key]);\n        };\n        vm.filterOwners = function (key) {\n            vm.ownerFilters[key] = !vm.ownerFilters[key];\n            toggleHide('owner', key, vm.ownerFilters[key]);\n        };\n\n        vm.setEventsColor = function (color, account) {\n\n            var cpEvents = angular.copy(vm.events);\n            var id = account.id;\n            cpEvents.forEach(function (e) {\n                if (e.calendar === id) {\n                    e.backgroundColor = color;\n                }\n            });\n            events.length = 0;\n            events.push(cpEvents);\n            $scope.$apply(); // required bc angular fullcalendar does not respond to change in event backgroundColor\n        };\n\n        activate();\n        function activate() {\n            logger.info('Activated Calendar View');\n        }\n    }\n})();\n\n//# sourceMappingURL=calendar.controller.js.map\n"]}